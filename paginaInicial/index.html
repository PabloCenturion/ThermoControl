<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet">

        <!-- Bootstrap Icons -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons/font/bootstrap-icons.css" rel="stylesheet">
  
    <link rel="stylesheet" href="styles.css">

    <title>ThermoControl</title>
</head>
<body>

    <section class="container-main">

    <nav>
        <p class="logo">ThermoControl</p>
        <a  style="text-decoration: underline;" href="/paginaInicial/index.html">Inicio</a>
        <a href="/paginaRelatorios/index.html">Relatórios</a>
        <a href="/paginaAlertasHistorico/index.html">Alertas</a>
        <a href="/paginaConfigurações/index.html">Configurações</a>       
    </nav>

    <section class="container-display-info">

        <p class="title">Status Da 'Sala De Servidores Da Uniamerica'</p>

    <div class="container-blocks">

        <article class="alerts-block">

            <p class="alert-title"><i class="bi bi-bell-fill bell-size"></i>Alertas</p>

            <p class="text-status-alerts">Sem Avisos</p>

        </article>

        <article class="ac-block">

            <p class="ac-title"><img src="/paginaInicial/imgsDoSite/airConditioner.png" alt="Icone Ar Condicionado"> Ar Condicionado</p>
        
        <div class="buttons-ac">


            <button type="button"><img src="/paginaInicial/imgsDoSite/plus-button.png" alt="icone mais"></button>

            <button type="button"><img src="/paginaInicial/imgsDoSite/Rectangle 6.png" alt="icone number temperature"></button>
            <p class="status-ac">Nan°C</p>

            <button type="button"><img src="/paginaInicial/imgsDoSite/negative-button.png" alt="icone menos"></button>

            <button type="button" class="icone-power"><img src="/paginaInicial/imgsDoSite/Rectangle 9.png" alt="icone power"></button>
            <p class="status-power"><i class="bi bi-power power-size"></i></p>


            </div>

        </article>

    </div>

    

        </section>

        <section class="container-blocks-status">

            <div class="temperature-block">
                <p class="temp-title"><i class="bi bi-thermometer-half thermometer-size"></i>Temperatura:</p>
                <h2 id="status-temperature" class="mold-text-center">Nan°C</h2>

            </div>

            <div class="umidity-block">

                <p class="umi-title"><i class="bi bi-droplet droplet-size"></i>Umidade:</p>
                <h2 id="status-umidity" class="mold-text-center">Nan%</h2>


            </div>

            <div class="power-block">

                <p class="pwr-title"><i class="bi bi-lightning flash-size"></i>Potência:</p>
                <h2 id="status-power" class="mold-text-center">NanW</h2>


            </div>

            <div class="current-block">

                <p class="crt-title"><i class="bi bi-outlet outlet-size"></i>Corrente:</p>
                <h2 id="status-current" class="mold-text-center">NanA</h2>


            </div>

        </section>
    </section>
    
    <!-- Script para buscar os dados do Arduino -->
    <script>

        /*Aqui, você define o endereço IP do Arduino (ou qualquer dispositivo conectado)
        que estará servindo os dados.*/

        const arduinoIP = 'http://192.168.1.100'; // Substitua pelo IP do seu Arduino

        /*Esta função é assíncrona (usando async), o que significa que ela pode aguardar
         operações que levam tempo (como fazer uma requisição a outro servidor).*/

        async function buscarSensorDados() {

            try {

                /*Aqui, o código usa fetch para fazer uma requisição HTTP ao IP do Arduino
                
                O await faz com que o JavaScript espere a resposta do Arduino antes de
                continuar com a execução.*/

                const respostaArduino = await fetch(arduinoIP);

                /*Caso a requisição não tenha sido bem-sucedida (por exemplo, o Arduino está fora do ar),
                 o código verifica se o status da resposta é "ok". Se não for (!), ele lança um erro com uma 
                 mensagem indicando o status da resposta.*/

                /*A propriedade ok é um atributo da resposta(response) do fetch contém um Boolean 
                informando se a resposta foi bem-sucedida true ou false. */

                if (!respostaArduino.ok) {
                    throw new Error(`Erro na requisição: ${respostaArduino.statusText}`);

                }

                //Conversão da resposta em JSON

                /*utilização do json() pois estamos pegando dados de uma requisição HTTP e 
                transformando num objeto JavaScript que pode ser manipulado no código.*/

                const dado = await respostaArduino.json();

                document.getElementById('status-temperature').innerText = `${dado.temperatura.toFixed(2)}°C`
                document.getElementById('status-humidity').innerText = `${dado.umidade.toFixed(2)}%`
                document.getElementById('status-power').innerText = `${dado.potencia.toFixed(2)}W`
                document.getElementById('status-current').innerText = `${dado.corrente.toFixed(2)}A`

            
        /*Se algum erro ocorrer durante a requisição 
        (como o Arduino estar offline ou o servidor responder com um erro)
        o código captura o erro e o exibe no console do navegador, permitindo depurar a situação.*/

            } catch (erro) {
                console.log('Erro ao buscar dados do Arduino:', erro);
            }
        }

        /* O setInterval chama a função buscarSensorDados a cada 5.000 milissegundos (5 segundos),
        garantindo que a página seja atualizada automaticamente com as leituras mais recentes do Arduino
        a cada 5 segundos.*/

        setInterval(buscarSensorDados, 5000);

        // Busca os dados imediatamente ao carregar a página
        window.onload = buscarSensorDados;
    </script>

</body>
</html>